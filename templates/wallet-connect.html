<!-- <!DOCTYPE html>
<html>
<head>
    <title>Connect Your Sui Wallet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        .title { 
            color: #333; 
            font-size: 28px; 
            margin-bottom: 20px; 
            font-weight: 600;
        }
        .subtitle {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        .status { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 20px 0; 
            text-align: center; 
            font-weight: 500;
            font-size: 14px;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border: 1px solid #bee5eb; 
        }
        .wallet-section {
            margin: 30px 0;
            padding: 25px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            background: #f8f9fa;
        }
        .wallet-section h3 {
            margin: 0 0 20px 0;
            color: #495057;
            font-size: 18px;
        }
        .connect-button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin: 10px 0;
        }
        .connect-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }
        .connect-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .manual-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            margin: 10px 0;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        .manual-input:focus {
            border-color: #4f46e5;
            outline: none;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .divider {
            margin: 30px 0;
            text-align: center;
            position: relative;
        }
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e9ecef;
        }
        .divider span {
            background: white;
            padding: 0 15px;
            color: #6c757d;
            font-size: 14px;
        }
        .wallet-connected {
            background: #d4edda !important;
            border-color: #28a745 !important;
        }
        .wallet-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .wallet-option:hover {
            border-color: #4f46e5;
            background: #f0f0ff;
        }
        .wallet-option.detected {
            border-color: #28a745;
            background: #f0fff0;
        }
        .wallet-name {
            font-weight: 500;
            color: #333;
        }
        .wallet-status {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Connect Your Wallet</div>
        <div class="subtitle">Choose how you'd like to connect your Sui wallet to continue</div>
        
        <div id="status" class="status info" style="display: none;">Ready to connect</div>
        
        <!-- Browser Extension Wallet Connection -->
        <!-- <div class="wallet-section">
            <h3>üöÄ Recommended: Use Wallet Extensions</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
                Connect with any installed Sui wallet extension
            </p>
            
            <div id="detected-wallets"></div>
            
            <button class="connect-button" id="extension-connect" onclick="detectAndConnectWallet()">
                Detect & Connect Wallet
            </button>
            <div id="wallet-status" style="margin-top: 10px; font-size: 12px; color: #666;"></div>
        </div>
        
        <div class="divider">
            <span>OR</span>
        </div>
        
        <!-- Manual Connection -->
        <div class="wallet-section">
            <h3>üìù Manual Connection</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                Enter your Sui wallet address directly -->
            <!-- </p>
            <input type="text" 
                   class="manual-input" 
                   id="manual-address" 
                   placeholder="Enter your Sui address (0x...)"
                   oninput="validateManualInput()">
            <button class="connect-button" 
                    id="manual-connect" 
                    onclick="connectManualWallet()" 
                    disabled>Connect Manual Wallet</button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Connecting your wallet...</p>
        </div>
    </div>

    <script>
        const STATE = '{{STATE}}';
        let detectedWallets = [];
        
        // Known Sui wallet extensions with their Chrome extension IDs
        const WALLET_EXTENSIONS = [
            {
                name: 'Suiet Wallet',
                id: 'khpkpbbcccdmmclmpigdgddabeilkdpd',
                key: 'suiet',
                displayName: 'Suiet Wallet',
                windowProperty: ['suiet', 'Suiet'],
                connectMethod: 'connect'
            },
            {
                name: 'Glass Wallet', 
                id: 'loinekcabhlmhjjbocijdoimmejangoa',
                key: 'glass',
                displayName: 'Glass Wallet',
                windowProperty: ['glass', 'glassWallet'],
                connectMethod: 'connect'
            },
            {
                name: 'Slush Wallet',
                id: 'hmjkpibdngfnboloaalapofkjdkdchld', 
                key: 'slush',
                displayName: 'Slush Wallet',
                windowProperty: ['slush', 'slushWallet'],
                connectMethod: 'connect'
            },
            {
                name: 'Martian Wallet',
                id: 'efbglgofoippbgcjepnhiblaibcnclgk',
                key: 'martian',
                displayName: 'Martian Wallet',
                windowProperty: ['martian', 'martianWallet'],
                connectMethod: 'connect'
            },
            {
                name: 'Sui Wallet',
                id: 'opcgpfmipidbgpenhmajoajpbobppdil',
                key: 'suiWallet',
                displayName: 'Sui Wallet',
                windowProperty: ['suiWallet', 'sui'],
                connectMethod: 'connect'
            },
            {
                name: 'Ethos Wallet',
                id: 'mcbigmjiafegjnnogedioegffbooigli',
                key: 'ethos',
                displayName: 'Ethos Wallet',
                windowProperty: ['ethos', 'ethosWallet'],
                connectMethod: 'connect'
            }
        ]; -->
        
        // Check if extension is installed by trying to access its web accessible resources
        // async function checkExtensionInstalled(extensionId) {
        //     return new Promise((resolve) => {
        //         // Method 1: Try to fetch a web accessible resource
        //         const img = new Image();
        //         img.onload = () => resolve(true);
        //         img.onerror = () => {
        //             // Method 2: Try to access extension URL
        //             fetch(`chrome-extension://${extensionId}/manifest.json`)
        //                 .then(() => resolve(true))
        //                 .catch(() => resolve(false));
        //         };
        //         // Many extensions have an icon as web accessible resource
        //         img.src = `chrome-extension://${extensionId}/icon.png`;
                
        //         // Timeout after 1 second
        //         setTimeout(() => resolve(false), 1000);
        //     });
        // }
        
        // Check if extension injects into window
        // function checkWindowProperty(wallet) {
        //     for (const prop of wallet.windowProperty) {
        //         if (window[prop] && typeof window[prop] === 'object') {
        //             console.log(`‚úÖ Found ${wallet.displayName} via window.${prop}`);
        //             return window[prop];
        //         }
        //     }
        //     return null;
        // } -->
        
        // Enhanced wallet detection using both extension ID and window injection
        // async function detectWallets() {
        //     console.log('üîç ENHANCED WALLET DETECTION STARTING...');
        //     console.log('==========================================');
            
        //     detectedWallets = [];
        //     const container = document.getElementById('detected-wallets');
        //     container.innerHTML = '<div class="wallet-status">Detecting wallets...</div>';
            
        //     console.log(`üìã Checking ${WALLET_EXTENSIONS.length} known wallet extensions...`);
            
        //     for (const wallet of WALLET_EXTENSIONS) {
        //         console.log(`\nüß™ Checking ${wallet.displayName} (${wallet.id})...`);
                
        //         // Check both extension presence and window injection
        //         const isExtensionInstalled = await checkExtensionInstalled(wallet.id);
        //         const windowObject = checkWindowProperty(wallet);
                
        //         console.log(`   - Extension installed: ${isExtensionInstalled}`);
        //         console.log(`   - Window injection: ${!!windowObject}`);
                
        //         if (windowObject) {
        //             // Extension is installed AND injected - ready to use
        //             console.log(`   ‚úÖ ${wallet.displayName} READY TO CONNECT`);
        //             detectedWallets.push({
        //                 ...wallet,
        //                 instance: windowObject,
        //                 detectionMethod: 'window-injection',
        //                 status: 'ready'
        //             });
        //         } else if (isExtensionInstalled) {
        //             // Extension is installed but not injected yet
        //             console.log(`   ‚è≥ ${wallet.displayName} INSTALLED BUT WAITING FOR INJECTION`);
        //             detectedWallets.push({
        //                 ...wallet,
        //                 instance: null,
        //                 detectionMethod: 'extension-only',
        //                 status: 'waiting'
        //             });
        //         } else {
        //             console.log(`   ‚ùå ${wallet.displayName} NOT FOUND`);
        //         }
        //     }
            
        //     // Also scan for any unrecognized wallets in window
        //     console.log('\nüîç Scanning for unrecognized wallets...');
        //     const knownProps = WALLET_EXTENSIONS.map(w => w.windowProperty).flat();
        //     const allWindowKeys = Object.keys(window);
            
        //     allWindowKeys.forEach(key => {
        //         if (knownProps.includes(key)) return; // Already checked
                
        //         try {
        //             const obj = window[key];
        //             if (obj && typeof obj === 'object') {
        //                 const hasSuiMethods = typeof obj.connect === 'function' || 
        //                                     typeof obj.getAccounts === 'function' ||
        //                                     typeof obj.signAndExecuteTransactionBlock === 'function';
                        
        //                 if (hasSuiMethods) {
        //                     console.log(`üÜï Found unrecognized Sui wallet: window.${key}`);
        //                     detectedWallets.push({
        //                         name: key,
        //                         id: 'unknown',
        //                         key: key,
        //                         displayName: `${key} (Unrecognized)`,
        //                         windowProperty: [key],
        //                         instance: obj,
        //                         detectionMethod: 'window-scan',
        //                         status: 'ready'
        //                     });
        //                 }
        //             }
        //         } catch (e) {
        //             // Ignore errors
        //         }
        //     });
            
        //     console.log('\nüéØ DETECTION RESULTS:');
        //     console.log(`   - Total wallets detected: ${detectedWallets.length}`);
        //     console.log(`   - Ready to connect: ${detectedWallets.filter(w => w.status === 'ready').length}`);
        //     console.log(`   - Waiting for injection: ${detectedWallets.filter(w => w.status === 'waiting').length}`);
            
        //     detectedWallets.forEach((wallet, index) => {
        //         console.log(`   ${index + 1}. ${wallet.displayName} - ${wallet.status} (${wallet.detectionMethod})`);
        //     });
        //     console.log('==========================================');
            
        //     displayDetectedWallets();
        //     return detectedWallets.length > 0;
        // }
        
        // // Display detected wallets with enhanced status information
        // function displayDetectedWallets() {
        //     const container = document.getElementById('detected-wallets');
        //     container.innerHTML = '';
            
        //     if (detectedWallets.length === 0) {
        //         container.innerHTML = '<div class="wallet-status">No wallet extensions detected. Please install a Sui wallet extension first.</div>';
        //         return;
        //     }
            
        //     detectedWallets.forEach(wallet => {
        //         const walletEl = document.createElement('div');
                
        //         if (wallet.status === 'ready') {
        //             walletEl.className = 'wallet-option detected';
        //             walletEl.innerHTML = `
        //                 <div>
        //                     <div class="wallet-name">${wallet.displayName}</div>
        //                     <div class="wallet-status">Ready to Connect</div>
        //                 </div>
        //                 <div style="color: #28a745;">‚úì</div>
        //             `;
        //             walletEl.onclick = () => connectSpecificWallet(wallet);
        //         } else if (wallet.status === 'waiting') {
        //             walletEl.className = 'wallet-option';
        //             walletEl.style.borderColor = '#ffc107';
        //             walletEl.style.backgroundColor = '#fff9e6';
        //             walletEl.innerHTML = `
        //                 <div>
        //                     <div class="wallet-name">${wallet.displayName}</div>
        //                     <div class="wallet-status">Installed but waiting for injection...</div>
        //                 </div>
        //                 <div style="color: #ffc107;">‚è≥</div>
        //             `;
        //             walletEl.onclick = () => {
        //                 updateStatus(`${wallet.displayName} is installed but not ready yet. Try refreshing the page or opening the wallet extension first.`, 'info');
        //             };
        //         } else {
        //             walletEl.className = 'wallet-option';
        //             walletEl.innerHTML = `
        //                 <div>
        //                     <div class="wallet-name">${wallet.displayName}</div>
        //                     <div class="wallet-status">Not Available</div>
        //                 </div>
        //                 <div style="color: #dc3545;">‚úó</div>
        //             `;
        //         }
                
        //         container.appendChild(walletEl);
        //     });
        // }
        
        // // Enhanced wallet detection and connection with retry logic
        // async function detectAndConnectWallet() {
        //     console.log('üîó Starting enhanced wallet detection and connection...');
        //     showLoading(true);
            
        //     try {
        //         updateStatus('Detecting wallet extensions...', 'info');
                
        //         const hasWallets = await detectWallets();
        //         if (!hasWallets) {
        //             throw new Error('No wallet extensions found. Please install a Sui wallet extension.');
        //         }
                
        //         // Try to connect to the first ready wallet
        //         const readyWallet = detectedWallets.find(w => w.status === 'ready');
        //         if (readyWallet) {
        //             await connectSpecificWallet(readyWallet);
        //         } else {
        //             // Check if there are wallets waiting for injection
        //             const waitingWallets = detectedWallets.filter(w => w.status === 'waiting');
        //             if (waitingWallets.length > 0) {
        //                 updateStatus(`Found ${waitingWallets.length} installed wallet(s) but they need more time to load. Trying again...`, 'info');
                        
        //                 // Wait a bit and try again
        //                 setTimeout(async () => {
        //                     await detectWallets();
        //                     const nowReadyWallet = detectedWallets.find(w => w.status === 'ready');
        //                     if (nowReadyWallet) {
        //                         await connectSpecificWallet(nowReadyWallet);
        //                     } else {
        //                         showLoading(false);
        //                         updateStatus('Wallets are installed but not ready. Please try refreshing the page or opening a wallet extension first.', 'info');
        //                     }
        //                 }, 3000);
        //             } else {
        //                 throw new Error('No wallet extensions found. Please install a Sui wallet extension.');
        //             }
        //         }
                
        //     } catch (error) {
        //         console.error('‚ùå Wallet detection/connection failed:', error);
        //         updateStatus('Connection failed: ' + error.message, 'error');
        //         showLoading(false);
        //     }
        // }
        
        // // Connect to a specific wallet with enhanced connection methods
        // async function connectSpecificWallet(walletInfo) {
        //     console.log(`üîó Connecting to ${walletInfo.displayName}...`);
            
        //     try {
        //         updateStatus(`Connecting to ${walletInfo.displayName}...`, 'info');
                
        //         // Use the detected wallet instance
        //         const wallet = walletInfo.instance || window[walletInfo.key];
                
        //         if (!wallet) {
        //             throw new Error(`${walletInfo.displayName} not found`);
        //         }
                
        //         console.log(`üìã Available methods for ${walletInfo.displayName}:`, Object.keys(wallet));
                
        //         let account;
        //         let result;
                
        //         // Try different connection methods based on wallet type
        //         if (typeof wallet.connect === 'function') {
        //             console.log(`üîå Using connect() method for ${walletInfo.displayName}`);
        //             result = await wallet.connect();
        //             console.log('Connect result:', result);
                    
        //             // Handle different response formats
        //             if (result && result.accounts && result.accounts.length > 0) {
        //                 account = result.accounts[0];
        //             } else if (result && result.account) {
        //                 account = result.account;
        //             } else if (result && result.address) {
        //                 account = result;
        //             } else {
        //                 // Try to get accounts after connection
        //                 if (typeof wallet.getAccounts === 'function') {
        //                     const accounts = await wallet.getAccounts();
        //                     account = accounts && accounts.length > 0 ? accounts[0] : null;
        //                 }
        //             }
        //         } else if (typeof wallet.requestPermissions === 'function') {
        //             console.log(`üîê Using requestPermissions() method for ${walletInfo.displayName}`);
        //             await wallet.requestPermissions();
                    
        //             if (typeof wallet.getAccounts === 'function') {
        //                 const accounts = await wallet.getAccounts();
        //                 account = accounts && accounts.length > 0 ? accounts[0] : null;
        //             }
        //         } else if (typeof wallet.enable === 'function') {
        //             console.log(`‚ö° Using enable() method for ${walletInfo.displayName}`);
        //             result = await wallet.enable();
        //             console.log('Enable result:', result);
                    
        //             if (result && result.accounts && result.accounts.length > 0) {
        //                 account = result.accounts[0];
        //             } else if (typeof wallet.getAccounts === 'function') {
        //                 const accounts = await wallet.getAccounts();
        //                 account = accounts && accounts.length > 0 ? accounts[0] : null;
        //             }
        //         } else {
        //             throw new Error(`${walletInfo.displayName} does not support any known connection method`);
        //         }
                
//                 console.log('Final account:', account);
                
//                 if (!account) {
//                     throw new Error('No account found after connection');
//                 }
                
//                 // Normalize account address format
//                 let walletAddress;
//                 if (account.address) {
//                     walletAddress = account.address;
//                 } else if (account.publicKey) {
//                     // Some wallets might only provide publicKey initially
//                     walletAddress = account.publicKey;
//                 } else if (typeof account === 'string') {
//                     walletAddress = account;
//                 } else {
//                     throw new Error('Could not extract wallet address from account');
//                 }
                
//                 console.log('‚úÖ Wallet connected:', {
//                     walletName: walletInfo.displayName,
//                     address: walletAddress,
//                     detectionMethod: walletInfo.detectionMethod
//                 });
                
//                 updateStatus('Wallet connected successfully!', 'success');
//                 updateWalletStatus(`Connected: ${walletInfo.displayName}`);
                
//                 // Submit to server
//                 await submitWalletConnection({
//                     walletAddress: walletAddress,
//                     walletName: walletInfo.key,
//                     signature: '',
//                     message: '',
//                     state: STATE,
//                     publicKey: account.publicKey || ''
//                 });
                
//             } catch (error) {
//                 console.error(`‚ùå ${walletInfo.displayName} connection failed:`, error);
                
//                 if (error.message.includes('User rejected') || error.message.includes('rejected') || error.message.includes('denied')) {
//                     updateStatus('Connection cancelled by user', 'error');
//                 } else {
//                     updateStatus(`${walletInfo.displayName} connection failed: ` + error.message, 'error');
//                 }
                
//                 throw error;
//             }
//         }
        
//         // Manual wallet connection
//         function validateManualInput() {
//             const address = document.getElementById('manual-address').value.trim();
//             const button = document.getElementById('manual-connect');
            
//             if (address.length >= 60 && address.startsWith('0x')) {
//                 button.disabled = false;
//             } else {
//                 button.disabled = true;
//             }
//         }
        
//         async function connectManualWallet() {
//             const address = document.getElementById('manual-address').value.trim();
//             console.log('üîó Manual wallet connection:', address);
            
//             showLoading(true);
//             updateStatus('Connecting manual wallet...', 'info');
            
//             try {
//                 await submitWalletConnection({
//                     walletAddress: address,
//                     walletName: 'manual',
//                     signature: '',
//                     message: '',
//                     state: STATE
//                 });
//             } catch (error) {
//                 console.error('‚ùå Manual wallet connection failed:', error);
//                 updateStatus('Manual connection failed: ' + error.message, 'error');
//                 showLoading(false);
//             }
//         }
        
//         // Submit connection to server
//         async function submitWalletConnection(data) {
//             console.log('üì§ Submitting to server:', data);
            
//             try {
//                 const response = await fetch('/auth/wallet-connect', {
//                     method: 'POST',
//                     headers: { 'Content-Type': 'application/json' },
//                     body: JSON.stringify(data)
//                 });
                
//                 const responseText = await response.text();
//                 console.log('Server response:', response.status, responseText);
                
//                 if (!response.ok) {
//                     throw new Error('Server error: ' + response.status + ' - ' + responseText);
//                 }
                
//                 const result = JSON.parse(responseText);
                
//                 if (result.success) {
//                     updateStatus('‚úÖ SUCCESS! Wallet connected successfully. You can close this window.', 'success');
                    
//                     // Mark the appropriate section as connected
//                     if (data.walletName !== 'manual') {
//                         document.querySelector('.wallet-section').classList.add('wallet-connected');
//                     }
                    
//                     // Auto-close after delay
//                     setTimeout(function() { 
//                         try { 
//                             window.close(); 
//                         } catch(e) { 
//                             console.log('Cannot auto-close window'); 
//                         }
//                     }, 2000);
//                 } else {
//                     throw new Error(result.error || 'Unknown error');
//                 }
                
//             } catch (error) {
//                 console.error('‚ùå Submit connection error:', error);
//                 throw error;
//             }
//         }
        
//         // Helper functions
//         function updateStatus(message, type) {
//             const statusEl = document.getElementById('status');
//             statusEl.textContent = message;
//             statusEl.className = 'status ' + type;
//             statusEl.style.display = 'block';
//             console.log('Status:', type, '-', message);
//         }
        
//         function updateWalletStatus(message) {
//             document.getElementById('wallet-status').textContent = message;
//         }
        
//         function showLoading(show) {
//             const loading = document.getElementById('loading');
//             const connectButton = document.getElementById('extension-connect');
//             const manualButton = document.getElementById('manual-connect');
            
//             if (show) {
//                 loading.style.display = 'block';
//                 connectButton.disabled = true;
//                 manualButton.disabled = true;
//             } else {
//                 loading.style.display = 'none';
//                 connectButton.disabled = false;
//                 validateManualInput();
//             }
//         }
        
//         // Initialize with extension-based detection and extended timing
//         window.addEventListener('DOMContentLoaded', () => {
//             console.log('üöÄ Page loaded, starting extension-based wallet detection...');
            
//             // Initial detection
//             detectWallets().then(() => {
//                 updateWalletStatus('Wallet detection complete');
                
//                 // Update button status based on results
//                 const readyWallets = detectedWallets.filter(w => w.status === 'ready');
//                 const waitingWallets = detectedWallets.filter(w => w.status === 'waiting');
                
//                 if (readyWallets.length > 0) {
//                     updateStatus(`‚úÖ Found ${readyWallets.length} ready wallet(s)!`, 'success');
//                 } else if (waitingWallets.length > 0) {
//                     updateStatus(`‚è≥ Found ${waitingWallets.length} installed wallet(s), waiting for them to load...`, 'info');
//                 } else {
//                     updateStatus('No wallet extensions detected. Please install and enable a Sui wallet.', 'info');
//                 }
//             });
            
//             // Extended detection for wallets that inject later
//             const retryIntervals = [2000, 5000, 8000]; // 2s, 5s, 8s
            
//             retryIntervals.forEach(delay => {
//                 setTimeout(async () => {
//                     console.log(`üîÑ Re-detecting wallets after ${delay}ms...`);
//                     const previousReady = detectedWallets.filter(w => w.status === 'ready').length;
                    
//                     await detectWallets();
                    
//                     const currentReady = detectedWallets.filter(w => w.status === 'ready').length;
//                     if (currentReady > previousReady) {
//                         console.log(`üìà Found ${currentReady - previousReady} additional ready wallet(s)`);
//                         updateStatus(`‚úÖ Found ${currentReady} ready wallet(s)!`, 'success');
//                     }
//                 }, delay);
//             });
//         });
        
//         // Also detect wallets when window gets focus (in case user opens wallet extension)
//         window.addEventListener('focus', async () => {
//             console.log('üîÑ Window focused, re-detecting wallets...');
//             await detectWallets();
//         });
//     </script>
// </body>
// </html>