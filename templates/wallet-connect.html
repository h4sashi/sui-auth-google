<!DOCTYPE html>
<html>
<head>
    <title>Sui Wallet Detection Debugger</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            background: #1a1a1a;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            color: white;
            font-size: 24px;
        }
        .section {
            background: #2a2a2a;
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
            border: 1px solid #444;
        }
        .section-header {
            background: #333;
            padding: 15px;
            border-bottom: 1px solid #444;
            font-weight: bold;
            color: #4CAF50;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .section-content {
            padding: 15px;
            display: block;
        }
        .collapsed .section-content {
            display: none;
        }
        .toggle {
            color: #888;
            font-size: 14px;
        }
        .found {
            color: #4CAF50;
        }
        .not-found {
            color: #f44336;
        }
        .warning {
            color: #ff9800;
        }
        .info {
            color: #2196F3;
        }
        .debug-output {
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        .wallet-item {
            background: #333;
            border: 1px solid #555;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
        }
        .wallet-name {
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }
        .wallet-details {
            font-size: 11px;
            color: #ccc;
        }
        .scan-button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .scan-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        .scan-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .property-list {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .property {
            margin: 3px 0;
            font-size: 11px;
        }
        .key {
            color: #f39c12;
        }
        .value {
            color: #95a5a6;
        }
        .method {
            color: #e74c3c;
        }
        .chrome-ext-id {
            font-family: monospace;
            background: #444;
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 10px;
        }
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-found { background: #4CAF50; }
        .status-partial { background: #ff9800; }
        .status-missing { background: #f44336; }
        
        .extension-check {
            background: #2d2d2d;
            border-left: 4px solid #2196F3;
            padding: 10px;
            margin: 10px 0;
        }
        
        .live-detection {
            position: sticky;
            top: 20px;
            background: #2a2a2a;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .detection-counter {
            text-align: center;
            font-size: 18px;
            color: #4CAF50;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Sui Wallet Detection Debugger</h1>
            <p>Advanced diagnostic tool for Sui wallet extension detection</p>
        </div>
        
        <div class="live-detection">
            <div style="text-align: center;">
                <button class="scan-button" onclick="runFullScan()" id="scanBtn">
                    üöÄ Run Full Detection Scan
                </button>
                <button class="scan-button" onclick="startLiveMonitoring()" id="liveBtn">
                    üì° Start Live Monitoring
                </button>
                <button class="scan-button" onclick="exportReport()" id="exportBtn">
                    üìÑ Export Report
                </button>
            </div>
            <div class="detection-counter" id="detectionCounter">
                Click "Run Full Detection Scan" to begin
            </div>
        </div>

        <div class="section" id="windowObjectsSection">
            <div class="section-header" onclick="toggleSection('windowObjectsSection')">
                <span>ü™ü Window Objects Detection</span>
                <span class="toggle" id="windowObjectsToggle">Click to expand</span>
            </div>
            <div class="section-content">
                <p>Scanning window object for wallet extensions...</p>
                <div id="windowObjectsResults" class="debug-output">
                    Not scanned yet
                </div>
            </div>
        </div>

        <div class="section" id="extensionManifestsSection">
            <div class="section-header" onclick="toggleSection('extensionManifestsSection')">
                <span>üß© Chrome Extension Manifests</span>
                <span class="toggle" id="extensionManifestsToggle">Click to expand</span>
            </div>
            <div class="section-content">
                <p>Attempting to detect installed Chrome extensions...</p>
                <div id="extensionManifestsResults" class="debug-output">
                    Not scanned yet
                </div>
            </div>
        </div>

        <div class="section" id="walletStandardSection">
            <div class="section-header" onclick="toggleSection('walletStandardSection')">
                <span>üì± Wallet Standard API</span>
                <span class="toggle" id="walletStandardToggle">Click to expand</span>
            </div>
            <div class="section-content">
                <p>Checking for Wallet Standard compliant wallets...</p>
                <div id="walletStandardResults" class="debug-output">
                    Not scanned yet
                </div>
            </div>
        </div>

        <div class="section" id="eventListenersSection">
            <div class="section-header" onclick="toggleSection('eventListenersSection')">
                <span>üì° Event-Based Detection</span>
                <span class="toggle" id="eventListenersToggle">Click to expand</span>
            </div>
            <div class="section-content">
                <p>Monitoring for wallet registration events...</p>
                <div id="eventListenersResults" class="debug-output">
                    Not scanned yet
                </div>
            </div>
        </div>

        <div class="section" id="networkRequestsSection">
            <div class="section-header" onclick="toggleSection('networkRequestsSection')">
                <span>üåê Network Resource Detection</span>
                <span class="toggle" id="networkRequestsToggle">Click to expand</span>
            </div>
            <div class="section-content">
                <p>Checking for wallet-related network resources...</p>
                <div id="networkRequestsResults" class="debug-output">
                    Not scanned yet
                </div>
            </div>
        </div>

        <div class="section" id="summarySection">
            <div class="section-header" onclick="toggleSection('summarySection')">
                <span>üìä Detection Summary</span>
                <span class="toggle" id="summaryToggle">Click to expand</span>
            </div>
            <div class="section-content">
                <div id="summaryResults">
                    Run a scan to see summary
                </div>
            </div>
        </div>
    </div>

    <script>
        let isLiveMonitoring = false;
        let liveMonitoringInterval;
        let detectionLog = [];
        let foundWallets = new Map();

        // Known Sui wallet configurations with enhanced detection
        const SUI_WALLET_CONFIGS = {
            suiet: {
                name: 'Suiet Wallet',
                windowKeys: ['suiet', 'suietWallet', '__suiet__', 'Suiet'],
                chromeExtensionId: 'khpkpbbcccdmmclmpigdgddabeilkdpd',
                manifestUrl: 'chrome-extension://khpkpbbcccdmmclmpigdgddabeilkdpd/manifest.json',
                contentScriptSignatures: ['suiet-content', 'suiet-inject'],
                domainDetection: ['suiet.app'],
                expectedMethods: ['connect', 'getAccounts', 'signAndExecuteTransaction']
            },
            suiWallet: {
                name: 'Sui Wallet (Official)',
                windowKeys: ['suiWallet', 'sui', '__sui__', 'SuiWallet'],
                chromeExtensionId: 'opcgpfmipidbgpenhmajoajpbobppdil',
                manifestUrl: 'chrome-extension://opcgpfmipidbgpenhmajoajpbobppdil/manifest.json',
                contentScriptSignatures: ['sui-wallet-content', 'sui-inject'],
                domainDetection: ['mystenlabs.com'],
                expectedMethods: ['connect', 'getAccounts', 'signTransaction']
            },
            martian: {
                name: 'Martian Wallet',
                windowKeys: ['martian', 'martianWallet', '__martian__', 'Martian'],
                chromeExtensionId: 'efbglgofoippbgcjepnhiblaibcnclgk',
                manifestUrl: 'chrome-extension://efbglgofoippbgcjepnhiblaibcnclgk/manifest.json',
                contentScriptSignatures: ['martian-content', 'martian-inject'],
                domainDetection: ['martianwallet.xyz'],
                expectedMethods: ['connect', 'account', 'signAndSubmitTransaction']
            },
            ethos: {
                name: 'Ethos Wallet',
                windowKeys: ['ethos', 'ethosWallet', '__ethos__', 'EthosWallet'],
                chromeExtensionId: null,
                manifestUrl: null,
                contentScriptSignatures: ['ethos-content'],
                domainDetection: ['ethoswallet.xyz'],
                expectedMethods: ['connect', 'getAccount', 'signTransaction']
            },
            glass: {
                name: 'Glass Wallet',
                windowKeys: ['glass', 'glassWallet', '__glass__', 'GlassWallet'],
                chromeExtensionId: null,
                manifestUrl: null,
                contentScriptSignatures: ['glass-content'],
                domainDetection: ['glass.finance'],
                expectedMethods: ['connect', 'getAccounts']
            },
            nightly: {
                name: 'Nightly Wallet',
                windowKeys: ['nightly', 'nightlyWallet', '__nightly__', 'NightlyWallet'],
                chromeExtensionId: null,
                manifestUrl: null,
                contentScriptSignatures: ['nightly-content'],
                domainDetection: ['nightly.app'],
                expectedMethods: ['connect', 'signTransaction']
            },
            surf: {
                name: 'Surf Wallet',
                windowKeys: ['surf', 'surfWallet', '__surf__', 'SurfWallet'],
                chromeExtensionId: null,
                manifestUrl: null,
                contentScriptSignatures: ['surf-content'],
                domainDetection: ['surf.surf'],
                expectedMethods: ['connect', 'getAccounts']
            }
        };

        function log(message, category = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = { timestamp, message, category };
            detectionLog.push(logEntry);
            console.log(`[${timestamp}] ${message}`);
        }

        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const toggle = document.getElementById(sectionId.replace('Section', 'Toggle'));
            
            if (section.classList.contains('collapsed')) {
                section.classList.remove('collapsed');
                toggle.textContent = 'Click to collapse';
            } else {
                section.classList.add('collapsed');
                toggle.textContent = 'Click to expand';
            }
        }

        // Enhanced window object detection
        async function detectWindowObjects() {
            log('üîç Starting window object detection');
            let results = [];
            let foundCount = 0;
            
            // Scan for known wallet keys
            for (const [walletId, config] of Object.entries(SUI_WALLET_CONFIGS)) {
                for (const key of config.windowKeys) {
                    if (window[key]) {
                        const wallet = window[key];
                        const walletInfo = analyzeWalletObject(wallet, key);
                        results.push(`‚úÖ FOUND: ${config.name}`);
                        results.push(`   ‚îî‚îÄ Key: window.${key}`);
                        results.push(`   ‚îî‚îÄ Type: ${typeof wallet}`);
                        results.push(`   ‚îî‚îÄ Methods: ${walletInfo.methods.join(', ')}`);
                        results.push(`   ‚îî‚îÄ Properties: ${walletInfo.properties.join(', ')}`);
                        results.push(`   ‚îî‚îÄ Is Sui: ${walletInfo.isSui ? 'YES' : 'NO'}`);
                        results.push('');
                        
                        foundWallets.set(config.name, {
                            ...config,
                            wallet,
                            detectionMethod: 'window',
                            windowKey: key,
                            analysis: walletInfo
                        });
                        foundCount++;
                        break;
                    }
                }
            }
            
            // Scan for unknown wallet objects
            const suspiciousKeys = [];
            for (const key of Object.keys(window)) {
                if (typeof window[key] === 'object' && window[key] !== null) {
                    const obj = window[key];
                    
                    // Check for wallet-like patterns
                    if (key.toLowerCase().includes('wallet') || 
                        key.toLowerCase().includes('sui') ||
                        (obj.connect && typeof obj.connect === 'function') ||
                        (obj.getAccounts && typeof obj.getAccounts === 'function')) {
                        
                        suspiciousKeys.push(key);
                    }
                }
            }
            
            if (suspiciousKeys.length > 0) {
                results.push('üîç UNKNOWN WALLET-LIKE OBJECTS:');
                for (const key of suspiciousKeys) {
                    const obj = window[key];
                    const analysis = analyzeWalletObject(obj, key);
                    results.push(`   ‚ö†Ô∏è window.${key}`);
                    results.push(`      ‚îî‚îÄ Type: ${typeof obj}`);
                    results.push(`      ‚îî‚îÄ Methods: ${analysis.methods.slice(0, 5).join(', ')}${analysis.methods.length > 5 ? '...' : ''}`);
                    results.push(`      ‚îî‚îÄ Might be Sui: ${analysis.isSui ? 'YES' : 'NO'}`);
                }
                results.push('');
            }
            
            // Check for standard wallet APIs
            const standardAPIs = [
                'ethereum', 'solana', 'phantom', 'aptos', 'petra',
                'WalletStandard', 'walletStandard', 'MysuiWalletStandard'
            ];
            
            results.push('üîç STANDARD WALLET APIs:');
            for (const api of standardAPIs) {
                if (window[api]) {
                    results.push(`   ‚úÖ window.${api} - ${typeof window[api]}`);
                } else {
                    results.push(`   ‚ùå window.${api} - Not found`);
                }
            }
            
            results.push('');
            results.push(`üìä SUMMARY: Found ${foundCount} Sui wallets via window detection`);
            
            document.getElementById('windowObjectsResults').textContent = results.join('\n');
            log(`Window detection complete: ${foundCount} wallets found`);
        }

        function analyzeWalletObject(obj, key) {
            const methods = [];
            const properties = [];
            let isSui = false;
            
            try {
                for (const prop in obj) {
                    if (typeof obj[prop] === 'function') {
                        methods.push(prop);
                    } else {
                        properties.push(prop);
                    }
                    
                    // Check for Sui indicators
                    if (prop.toLowerCase().includes('sui') || 
                        key.toLowerCase().includes('sui') ||
                        key.toLowerCase().includes('suiet')) {
                        isSui = true;
                    }
                }
                
                // Check for Sui-specific methods
                const suiMethods = ['signAndExecuteTransaction', 'getAccount', 'getAccounts'];
                if (suiMethods.some(method => methods.includes(method))) {
                    isSui = true;
                }
                
                // Check for constructor or prototype hints
                if (obj.constructor && obj.constructor.name.toLowerCase().includes('sui')) {
                    isSui = true;
                }
                
            } catch (e) {
                methods.push('(analysis failed)');
            }
            
            return { methods, properties, isSui };
        }

        // Chrome extension manifest detection
        async function detectExtensionManifests() {
            log('üß© Starting Chrome extension detection');
            let results = [];
            let foundCount = 0;
            
            const checks = [];
            
            for (const [walletId, config] of Object.entries(SUI_WALLET_CONFIGS)) {
                if (config.chromeExtensionId && config.manifestUrl) {
                    checks.push({
                        name: config.name,
                        id: config.chromeExtensionId,
                        manifestUrl: config.manifestUrl
                    });
                }
            }
            
            results.push('üîç CHECKING CHROME EXTENSIONS:');
            results.push('');
            
            const checkPromises = checks.map(async (check) => {
                try {
                    // Try multiple detection methods
                    const methods = [
                        // Method 1: Try to fetch manifest
                        () => fetch(check.manifestUrl, { method: 'HEAD' }),
                        
                        // Method 2: Try to create image with extension URL
                        () => new Promise((resolve, reject) => {
                            const img = new Image();
                            img.onload = () => resolve('loaded');
                            img.onerror = () => reject('failed');
                            img.src = `chrome-extension://${check.id}/icon.png`;
                            setTimeout(() => reject('timeout'), 1000);
                        }),
                        
                        // Method 3: Check for injected content scripts
                        () => {
                            const scripts = Array.from(document.querySelectorAll('script'));
                            const extensionScript = scripts.find(script => 
                                script.src && script.src.includes(check.id)
                            );
                            return extensionScript ? Promise.resolve('found') : Promise.reject('not found');
                        }
                    ];
                    
                    let detected = false;
                    const methodResults = [];
                    
                    for (let i = 0; i < methods.length; i++) {
                        try {
                            await methods[i]();
                            methodResults.push(`Method ${i + 1}: ‚úÖ`);
                            detected = true;
                            break;
                        } catch (e) {
                            methodResults.push(`Method ${i + 1}: ‚ùå (${e.message || e})`);
                        }
                    }
                    
                    if (detected) {
                        results.push(`‚úÖ ${check.name}`);
                        results.push(`   ‚îî‚îÄ Extension ID: ${check.id}`);
                        results.push(`   ‚îî‚îÄ Detection: ${methodResults.find(r => r.includes('‚úÖ'))}`);
                        foundCount++;
                    } else {
                        results.push(`‚ùå ${check.name}`);
                        results.push(`   ‚îî‚îÄ Extension ID: ${check.id}`);
                        results.push(`   ‚îî‚îÄ All methods failed`);
                    }
                    
                } catch (error) {
                    results.push(`‚ùå ${check.name} - Error: ${error.message}`);
                }
            });
            
            await Promise.allSettled(checkPromises);
            
            results.push('');
            results.push(`üìä SUMMARY: Detected ${foundCount} extensions via manifest checking`);
            
            document.getElementById('extensionManifestsResults').textContent = results.join('\n');
            log(`Extension detection complete: ${foundCount} extensions found`);
        }

        // Wallet Standard API detection
        async function detectWalletStandard() {
            log('üì± Starting Wallet Standard detection');
            let results = [];
            let foundCount = 0;
            
            const possibleAPIs = [
                { path: 'window.WalletStandard', getter: () => window.WalletStandard },
                { path: 'window.walletStandard', getter: () => window.walletStandard },
                { path: 'window.MysuiWalletStandard', getter: () => window.MysuiWalletStandard },
                { path: 'window.navigator.wallets', getter: () => window.navigator?.wallets },
                { path: 'window.sui.getWallets', getter: () => window.sui?.getWallets },
            ];
            
            results.push('üîç CHECKING WALLET STANDARD APIs:');
            results.push('');
            
            for (const api of possibleAPIs) {
                try {
                    const apiObj = api.getter();
                    if (apiObj) {
                        results.push(`‚úÖ ${api.path} - Found`);
                        results.push(`   ‚îî‚îÄ Type: ${typeof apiObj}`);
                        
                        if (typeof apiObj.getWallets === 'function') {
                            try {
                                const wallets = apiObj.getWallets();
                                results.push(`   ‚îî‚îÄ getWallets(): Found ${wallets.length} wallets`);
                                
                                for (const wallet of wallets) {
                                    const isSui = checkIfSuiWallet(wallet);
                                    if (isSui) {
                                        results.push(`      ‚úÖ Sui Wallet: ${wallet.name || 'Unknown'}`);
                                        results.push(`         ‚îî‚îÄ Chains: ${(wallet.chains || []).join(', ')}`);
                                        results.push(`         ‚îî‚îÄ Features: ${Object.keys(wallet.features || {}).join(', ')}`);
                                        foundWallets.set(wallet.name || `Standard-${foundCount}`, {
                                            name: wallet.name,
                                            wallet,
                                            detectionMethod: 'standard',
                                            api: api.path
                                        });
                                        foundCount++;
                                    } else {
                                        results.push(`      ‚ùå Non-Sui Wallet: ${wallet.name || 'Unknown'}`);
                                    }
                                }
                            } catch (e) {
                                results.push(`   ‚îî‚îÄ getWallets() failed: ${e.message}`);
                            }
                        } else if (typeof apiObj.get === 'function') {
                            try {
                                const walletsRegistry = apiObj.get();
                                results.push(`   ‚îî‚îÄ get(): Found registry with ${walletsRegistry.length || 'unknown'} wallets`);
                            } catch (e) {
                                results.push(`   ‚îî‚îÄ get() failed: ${e.message}`);
                            }
                        } else {
                            results.push(`   ‚îî‚îÄ Methods: ${Object.keys(apiObj).join(', ')}`);
                        }
                    } else {
                        results.push(`‚ùå ${api.path} - Not found`);
                    }
                } catch (error) {
                    results.push(`‚ùå ${api.path} - Error: ${error.message}`);
                }
            }
            
            results.push('');
            results.push(`üìä SUMMARY: Found ${foundCount} Sui wallets via Wallet Standard`);
            
            document.getElementById('walletStandardResults').textContent = results.join('\n');
            log(`Wallet Standard detection complete: ${foundCount} wallets found`);
        }

        function checkIfSuiWallet(wallet) {
            if (!wallet) return false;
            
            const name = (wallet.name || '').toLowerCase();
            const chains = wallet.chains || [];
            const features = Object.keys(wallet.features || {});
            
            // Check name
            if (name.includes('sui') || name.includes('suiet') || name.includes('martian')) {
                return true;
            }
            
            // Check chains
            if (chains.some(chain => chain.toLowerCase().includes('sui'))) {
                return true;
            }
            
            // Check features
            if (features.some(feature => feature.startsWith('sui:'))) {
                return true;
            }
            
            return false;
        }

        // Event-based detection
        async function detectEventListeners() {
            log('üì° Setting up event-based detection');
            let results = [];
            let eventCount = 0;
            
            results.push('üîç SETTING UP EVENT LISTENERS:');
            results.push('');
            
            const walletEvents = [
                'wallet-standard:register-wallet',
                'suiet:connected',
                'sui:connected',
                'martian:connected',
                'wallet:ready',
                'DOMContentLoaded'
            ];
            
            const eventHandler = (event) => {
                eventCount++;
                const eventInfo = `[${new Date().toLocaleTimeString()}] ${event.type}`;
                results.push(`üì° ${eventInfo}`);
                if (event.detail) {
                    results.push(`   ‚îî‚îÄ Detail: ${JSON.stringify(event.detail, null, 2)}`);
                }
                document.getElementById('eventListenersResults').textContent = results.join('\n');
                log(`Event detected: ${event.type}`);
            };
            
            walletEvents.forEach(eventName => {
                window.addEventListener(eventName, eventHandler);
                results.push(`‚úÖ Listening for: ${eventName}`);
            });
            
            results.push('');
            results.push('üì° Event listeners active. Any wallet events will appear below:');
            results.push(`üìä Events detected so far: ${eventCount}`);
            
            document.getElementById('eventListenersResults').textContent = results.join('\n');
            
            // Trigger a custom event to test
            setTimeout(() => {
                window.dispatchEvent(new CustomEvent('wallet-debugger:test', {
                    detail: { message: 'Event system working' }
                }));
            }, 1000);
        }

        // Network resource detection
        async function detectNetworkResources() {
            log('üåê Starting network resource detection');
            let results = [];
            let foundCount = 0;
            
            results.push('üîç CHECKING NETWORK RESOURCES:');
            results.push('');
            
            // Check for wallet-related domains in loaded resources
            const loadedResources = performance.getEntriesByType('resource');
            const walletDomains = [];
            
            for (const config of Object.values(SUI_WALLET_CONFIGS)) {
                if (config.domainDetection) {
                    walletDomains.push(...config.domainDetection);
                }
            }
            
            results.push('üìä ANALYZING LOADED RESOURCES:');
            results.push(`Total resources loaded: ${loadedResources.length}`);
            results.push('');
            
            const walletRelatedResources = loadedResources.filter(resource => {
                return walletDomains.some(domain => resource.name.includes(domain)) ||
                       resource.name.includes('wallet') ||
                       resource.name.includes('sui') ||
                       resource.name.includes('chrome-extension');
            });
            
            if (walletRelatedResources.length > 0) {
                results.push('‚úÖ WALLET-RELATED RESOURCES FOUND:');
                walletRelatedResources.forEach(resource => {
                    results.push(`   ‚Ä¢ ${resource.name}`);
                    results.push(`     ‚îî‚îÄ Type: ${resource.initiatorType || 'unknown'}`);
                    results.push(`     ‚îî‚îÄ Duration: ${resource.duration.toFixed(2)}ms`);
                });
                foundCount = walletRelatedResources.length;
            } else {
                results.push('‚ùå No wallet-related resources detected');
            }
            
            // Try to ping known extension URLs
            results.push('');
            results.push('üîç TESTING EXTENSION ACCESSIBILITY:');
            
            const extensionTests = [];
            for (const [walletId, config] of Object.entries(SUI_WALLET_CONFIGS)) {
                if (config.chromeExtensionId) {
                    extensionTests.push({
                        name: config.name,
                        id: config.chromeExtensionId,
                        testUrl: `chrome-extension://${config.chromeExtensionId}/manifest.json`
                    });
                }
            }
            
            const testPromises = extensionTests.map(async (test) => {
                try {
                    const response = await fetch(test.testUrl, { 
                        method: 'HEAD',
                        mode: 'no-cors' 
                    });
                    results.push(`‚úÖ ${test.name} - Extension accessible`);
                } catch (error) {
                    results.push(`‚ùå ${test.name} - Extension not accessible (${error.message})`);
                }
            });
            
            await Promise.allSettled(testPromises);
            
            results.push('');
            results.push(`üìä SUMMARY: Found ${foundCount} wallet-related network resources`);
            
            document.getElementById('networkRequestsResults').textContent = results.join('\n');
            log(`Network resource detection complete: ${foundCount} resources found`);
        }

        // Run full scan
        async function runFullScan() {
            const scanBtn = document.getElementById('scanBtn');
            scanBtn.disabled = true;
            scanBtn.textContent = 'üîÑ Scanning...';
            
            foundWallets.clear();
            detectionLog = [];
            
            log('üöÄ Starting full wallet detection scan');
            
            try {
                await Promise.all([
                    detectWindowObjects(),
                    detectExtensionManifests(),
                    detectWalletStandard(),
                    detectEventListeners(),
                    detectNetworkResources()
                ]);
                
                updateSummary();
                updateDetectionCounter();
                
            } catch (error) {
                log(`‚ùå Scan error: ${error.message}`, 'error');
            } finally {
                scanBtn.disabled = false;
                scanBtn.textContent = 'üöÄ Run Full Detection Scan';
            }
        }

        function updateSummary() {
            const summary = [];
            
            summary.push('üìä WALLET DETECTION SUMMARY');
            summary.push('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            summary.push('');
            
            if (foundWallets.size === 0) {
                summary.push('‚ùå NO SUI WALLETS DETECTED');
                summary.push('');
                summary.push('This could mean:');
                summary.push('‚Ä¢ No Sui wallet extensions are installed');
                summary.push('‚Ä¢ Extensions are installed but not yet loaded');
                summary.push('‚Ä¢ Extensions are using non-standard injection methods');
                summary.push('‚Ä¢ Extensions are blocked by browser security');
                summary.push('');
                summary.push('üîß TROUBLESHOOTING STEPS:');
                summary.push('1. Install a Sui wallet extension (Suiet, Sui Wallet, etc.)');
                summary.push('2. Refresh this page after installation');
                summary.push('3. Check browser developer console for errors');
                summary.push('4. Try disabling other extensions temporarily');
                summary.push('5. Ensure extensions are enabled in incognito mode if testing there');
            } else {
                summary.push(`‚úÖ FOUND ${foundWallets.size} SUI WALLET(S):`);
                summary.push('');
                
                foundWallets.forEach((config, name) => {
                    summary.push(`üîó ${name}`);
                    summary.push(`   ‚îî‚îÄ Detection: ${config.detectionMethod}`);
                    if (config.windowKey) {
                        summary.push(`   ‚îî‚îÄ Window key: ${config.windowKey}`);
                    }
                    if (config.api) {
                        summary.push(`   ‚îî‚îÄ API: ${config.api}`);
                    }
                    if (config.analysis) {
                        summary.push(`   ‚îî‚îÄ Methods: ${config.analysis.methods.length} found`);
                        summary.push(`   ‚îî‚îÄ Sui compatible: ${config.analysis.isSui ? 'YES' : 'NO'}`);
                    }
                    summary.push('');
                });
                
                summary.push('‚úÖ RECOMMENDATIONS:');
                summary.push('‚Ä¢ Your wallet detection system should work with these wallets');
                summary.push('‚Ä¢ Consider adding fallback detection methods');
                summary.push('‚Ä¢ Test connection flow with each detected wallet');
            }
            
            summary.push('');
            summary.push('üîç DETECTION METHODS USED:');
            summary.push('‚Ä¢ Window object scanning');
            summary.push('‚Ä¢ Chrome extension manifest checking');
            summary.push('‚Ä¢ Wallet Standard API detection');
            summary.push('‚Ä¢ Event-based detection');
            summary.push('‚Ä¢ Network resource analysis');
            
            document.getElementById('summaryResults').innerHTML = 
                '<div class="debug-output">' + summary.join('\n') + '</div>';
        }

        function updateDetectionCounter() {
            const counter = document.getElementById('detectionCounter');
            if (foundWallets.size === 0) {
                counter.innerHTML = '‚ùå No Sui wallets detected';
                counter.style.color = '#f44336';
            } else {
                counter.innerHTML = `‚úÖ Found ${foundWallets.size} Sui wallet(s)`;
                counter.style.color = '#4CAF50';
            }
        }

        function startLiveMonitoring() {
            const liveBtn = document.getElementById('liveBtn');
            
            if (isLiveMonitoring) {
                // Stop monitoring
                clearInterval(liveMonitoringInterval);
                isLiveMonitoring = false;
                liveBtn.textContent = 'üì° Start Live Monitoring';
                log('üõë Live monitoring stopped');
            } else {
                // Start monitoring
                isLiveMonitoring = true;
                liveBtn.textContent = 'üõë Stop Live Monitoring';
                log('üì° Live monitoring started');
                
                liveMonitoringInterval = setInterval(() => {
                    log('üîÑ Live monitoring check...');
                    detectWindowObjects();
                }, 5000);
            }
        }

        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                foundWallets: Object.fromEntries(foundWallets),
                detectionLog: detectionLog,
                browserInfo: {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    cookieEnabled: navigator.cookieEnabled
                },
                pageInfo: {
                    url: window.location.href,
                    domain: window.location.hostname,
                    protocol: window.location.protocol
                }
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { 
                type: 'application/json' 
            });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `sui-wallet-detection-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('üìÑ Report exported');
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            log('üöÄ Sui Wallet Debugger initialized');
            
            // Expand the first section by default
            document.getElementById('windowObjectsSection').classList.remove('collapsed');
            
            // Auto-run scan after 2 seconds
            setTimeout(() => {
                log('üîÑ Auto-running initial scan...');
                runFullScan();
            }, 2000);
        });

        // Monitor for new wallet injections
        const observer = new MutationObserver((mutations) => {
            let shouldRescan = false;
            
            mutations.forEach((mutation) => {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach((node) => {
                        if (node.tagName === 'SCRIPT' && 
                            (node.src?.includes('wallet') || 
                             node.src?.includes('sui') || 
                             node.src?.includes('chrome-extension'))) {
                            log(`üì± New wallet script detected: ${node.src}`);
                            shouldRescan = true;
                        }
                    });
                }
            });
            
            if (shouldRescan && !isLiveMonitoring) {
                setTimeout(runFullScan, 3000);
            }
        });
        
        observer.observe(document.head, { childList: true, subtree: true });
        observer.observe(document.body, { childList: true, subtree: true });
    </script>
</body>
</html>